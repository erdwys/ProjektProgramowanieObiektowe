<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

    <head>
        <title>Panel Użytkownika</title>
        <link rel="stylesheet" type="text/css"
              href="webjars/bootstrap/3.3.7/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" media="all"  
              href="../css/user.css"  th:href="@{/css/user.css}" />

        <meta charset="utf-8" />


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"/>
        <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.1/css/buttons.dataTables.min.css"/>
        <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.5/css/select.dataTables.min.css"/>
        <link rel="stylesheet" type="text/css" media="all"  
              href="../css/editor.dataTables.min.css"  th:href="@{/css/editor.dataTables.min.css}" />

        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>


        <script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/select/1.2.5/js/dataTables.select.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js"></script>


    </head>
    <body>
        <nav class="navbar navbar-inverse">
            <div  class="container">
                <div class="navbar-header">
                    <a class="navbar-brand " th:href="@{/user}">Panel Użytkownika</a>
                </div>

            </div>
        </nav>
        <nav class="navbar navbar-inverse">
            <div  class="container">
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li ><a href="#start" th:href="@{/user}">Start</a></li>
                        <li class="active"><a href="#rozrachunki" th:href="@{/user_Rozrachunki}">Rozrachunki</a></li>
                        <li><a href="#zobowiazania" th:href="@{/user_Zobowiazania}">Zobowiązania</a></li>
                        <li><a href="#bank" th:href="@{/user_bank}">Konto bankowe</a></li>
                        <li><a href="#licznik" th:href="@{/user_licznik}">Odczyt liczników</a></li>
                      <li ><a  th:href="@{/user_konto}">Konto</a></li>
                        <li style="  position: absolute; left: 94%; background-color: black">

                            <a th:href="@{/login?logout}" onclick="$('#form').submit();">
                                Wyloguj
                            </a>
                            <form style="visibility: hidden" id="form" method="post"  th:action="@{/logout}"></form>
                        </li>
                    </ul>
                </div>

            </div>
        </nav>

        <table id="user_rozrachunki_Table" class="display" cellspacing="0" width="100%">

            <!-- Header Table -->
            <thead class="display headAndFooter">
                <tr>
                    <th>Nr wyciągu</th>
                    <th>Kwota</th>
                    <th>Data</th>
                    <th>Opis</th>
                    <th>Składka</th>
                    <th>Czynsz</th>
                    <th>Awrbp</th>
                    <th>Wpisowe</th>
                    <th>Energia rozpoczęcia sezonu</th>
                    <th>Energia zakończenia sezonu</th>
                    <th>Dyżur z roku poprzedniego na bieżący</th>
                    <th>Dyżur z roku bieżącego na następny</th>
                    <th>Zadłużenie z roku poprzedniego</th>

                </tr>
            </thead>

            <!-- Footer Table -->
            <tfoot class="display headAndFooter">
                <tr>
                      <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                      <th></th>
             <th></th>
                     <th></th>
                </tr>
            </tfoot>
        </table>
        <script src="/jQuery-2.1.4.min.js"></script>
        <script src="/jquery.dataTables.js"></script>
        <script src="/dataTables.bootstrap.min.js"></script>
        <script src="/jquery.spring-friendly.js"></script>
        <script src="../../js/dataTables.editor.min.js"></script>

        <script>


                                $(document).ready(function () {

                                    var table = $('#user_rozrachunki_Table').DataTable({
                                        
                                        "footerCallback": function ( row, data, start, end, display ) {
            var api = this.api(), data;
 
            // converting to interger to find total
            var intVal = function ( i ) {
                return typeof i === 'string' ?
                    i.replace(/[\$,]/g, '')*1 :
                    typeof i === 'number' ?
                        i : 0;
            };
 
            // computing column Total of the complete result 
            var kwotaTotal = api
                .column( 1 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
				
	    var skladkaTotal = api
                .column( 4 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
				
            var czynszTotal = api
                .column( 5 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
				
	     var awrbpTotal = api
                .column( 6 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
				
	     var wpisoweTotal = api
                .column( 7 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
                
                     var energ1Total = api
                .column( 8 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
                     var energ2Total = api
                .column( 9 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
                     var dyz1Total = api
                .column( 10 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
                     var dyz2Total = api
                .column( 11 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
                
                     var zadlTotal = api
                .column( 12 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
			
				
            // Update footer by showing the total with the reference of the column index 
	    $( api.column( 0 ).footer() ).html('Suma');
            $( api.column( 1 ).footer() ).html(kwotaTotal);      
            $( api.column( 4 ).footer() ).html(skladkaTotal);
            $( api.column( 5 ).footer() ).html(czynszTotal);
             $( api.column( 6 ).footer() ).html(awrbpTotal);
            $( api.column( 7 ).footer() ).html(wpisoweTotal);
             $( api.column( 8 ).footer() ).html(energ1Total);
            $( api.column( 9 ).footer() ).html(energ2Total);
             $( api.column( 10 ).footer() ).html(dyz1Total);
            $( api.column( 11 ).footer() ).html(dyz2Total);
             $( api.column( 12 ).footer() ).html(zadlTotal);
        },

                                        
                                          dom: "Bfrtip",
                                        "processing": true,
                                        "serverSide": false,
                                        "sAjaxSource": "/user_rozrachunki/get",
                                        "sAjaxDataProp": "",
                                        dataType: 'json',
                                          columns: [
                                            {data: "nrWyciagu"},
                                            {data: "kwota"},
                                               {data: "data"},
                                            {data: "opis"},
                                            {data: "skladka"},
                                            {data: "cynsz"},
                                            {data: "awrbp"},
                                            {data: "wpisowe"},
                                            {data: "energiaRozpoczecieSezonu"},
                                            {data: "energiaZakonczenieSezonu"},
                                            {data: "dyzurZRokuPoprzedniegoNaBiezacy"},
                                            {data: "dyzurZRokuBiezacegoNaNastepny"},
                                            {data: "zadluzenieZRokuPoprzedniego"},
                                      
                                        ],

                                        select: true,
                                        idSrc: "nrWyciagu",
                                                buttons: [

                                            {extend: 'pdfHtml5', orientation: 'landscape',
                                                pageSize: 'LEGAL', download: 'open'}
                                                ]
                                    });
                                });




        </script>



    </body>
</html>